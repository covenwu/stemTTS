<!DOCTYPE html>
<html>
<head>
	<style>
	li{list-style-type:none}
    </style>
	<meta charset=UTF-8>
</head>
<body>
<form action="#" method="POST">
	<div id="1">
	 任务1<br>
	 <a href="任务邮件.html?x=1" target="l1">任务邮件</a><br>
	 <a href="资源.html?x=1" target="l1">资源</a><br>
	 <a href="评价.html?x=1" target="l1">评价</a><br>
	 <a href="讨论.html?x=1" target="l1">讨论</a><br>
	 <a href="反馈邮件.html?x=1" target="l1">反馈邮件</a><br>
	</div>
<button id="btn2" type="button" style="display: none"></button>
<button id="btn22" type="button">添加任务</button>
</form>

<script src="jquery-3.3.1.min.js"></script>
<script type="text/javascript">
var options = ['', '111', '222', '333', '444'];
var form = document.querySelector('form');
var btn2 = document.querySelector('#btn2');
var btn22 = document.querySelector('#btn22');
var x=2;
var xm;

btn2.addEventListener('click', createSelect);
btn22.addEventListener('click', createSelect2);
form.addEventListener('click', delSelect);


function createSelect(ev) {
    var ele = document.createElement('div');
    ele.innerHTML ="任务"+x+"<br>"+'<a href="任务邮件.html?x='+x+'" target="l1">'+'任务邮件'+'</a>'+"<br>"+
        '<a href="资源.html?x='+x+'" target="l1">'+'资源'+'</a>'+"<br>"+
        '<a href="评价.html?x='+x+'" target="l1">'+'评价'+'</a>'+"<br>"+
        '<a href="讨论.html?x='+x+'" target="l1">'+'讨论'+'</a>'+"<br>"+
        '<a href="反馈邮件.html?x='+x+'" target="l1">'+'反馈邮件'+'</a>'+"<br>"+
        '<button class="del-btn" type="button">删除任务</button>'+"<br>";
    ele.setAttribute("id",x);
    form.insertBefore(ele, ev.currentTarget);
    xm=x;
    x+=1;
}

function createSelect2(ev) {
  var ele = document.createElement('div');
  ele.innerHTML ="任务"+x+"<br>"+'<a href="任务邮件.html?x='+x+'" target="l1">'+'任务邮件'+'</a>'+"<br>"+
                 '<a href="资源.html?x='+x+'" target="l1">'+'资源'+'</a>'+"<br>"+
                 '<a href="评价.html?x='+x+'" target="l1">'+'评价'+'</a>'+"<br>"+
                 '<a href="讨论.html?x='+x+'" target="l1">'+'讨论'+'</a>'+"<br>"+
                 '<a href="反馈邮件.html?x='+x+'" target="l1">'+'反馈邮件'+'</a>'+"<br>"+
                 '<button class="del-btn" type="button">删除任务</button>'+"<br>";
  ele.setAttribute("id",x);
  form.insertBefore(ele, ev.currentTarget);
  xm=x;

    $.ajax({
        //几个参数需要注意一下
        type: "GET",//方法类型
        dataType: "json",//预期服务器返回的数据类型
        url: "project1.php" ,//url
        data: {
            q:'addTask',
			p:x
		},
        success: function (result) {
            console.log(result);//打印服务端返回的数据(调试用)
            if (result.resultCode == 200) {
                alert("SUCCESS");
            };
        },
        error : function() {
            alert("完成！");
        }
    });
    x+=1;
}

function delSelect(ev) {
  if (ev.target.className.indexOf('del-btn') < 0) return;
  var ele = ev.target.parentNode;
  var xp=ele.getAttribute("id");
  form.removeChild(ele);

    $.ajax({
        //几个参数需要注意一下
        type: "GET",//方法类型
        dataType: "json",//预期服务器返回的数据类型
        url: "project1.php" ,//url
        data: {
            q:'deleteTask',
            p:xp
        },
        success: function (result) {
            console.log(result);//打印服务端返回的数据(调试用)
            if (result.resultCode == 200) {
                alert("SUCCESS");
            };
        },
        error : function() {
            alert("完成！");
        }
    });
  if(xp==xm){x-=1;xm-=1;}
}

function updateOptions(ev) {
  var val = inputColor.value.trim();
  if (ev && val.length <= 0) return;
  if (val) options.push(inputColor.value);
  var html = getOptionsHtml();
  var eles = Array.prototype.slice.call(form.querySelectorAll('select'));
  eles.forEach(function(ele) {
    ele.innerHTML = html;
  });
}

function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return decodeURI(r[2]);
    return null;
}



window.onload=function(){
    var xmlhttp;
    if (window.XMLHttpRequest)
    {// code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
    }
    else
    {// code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange=function()
    {
        if (xmlhttp.readyState==4 && xmlhttp.status==200)
        {
        //       alert(xmlhttp.responseText);
            var str=eval(xmlhttp.responseText);
            var i=1;
      //      console.log(str[0]);
            for(i=1;i<str[0];i++){
         //       createSelect;
				x=str[i+1];
				document.getElementById('btn2').click();
            }
        }
    }
 //   var x = getQueryString("x");
    xmlhttp.open("GET","project1.php?p="+0+"&q=task",true);
    xmlhttp.send();
}



</script>

</body>
</html>